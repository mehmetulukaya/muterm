version: 1.0.{build}

image: Visual Studio 2022

install:
  - choco install lazarus --version=4.0.0 --yes

before_build:
  - set PATH=C:\lazarus\fpc\3.2.2\bin\x86_64-win64;C:\lazarus;%PATH%
  - lazbuild --version

  - mkdir C:\Components

  # LNet - Doğru yolları kullan
  - git clone https://github.com/almindor/lnet.git C:\Components\lnet
  - echo "Compiling LNet packages..."
  - lazbuild --build-ide= C:\Components\lnet\lazaruspackage\lnetbase.lpk
  - lazbuild --build-ide= C:\Components\lnet\lazaruspackage\lnetvisual.lpk

  # LazSerial
  - git clone https://github.com/JurassicPork/TLazSerial.git C:\Components\lazserial
  - echo "Installing LazSerial..."
  - lazbuild --add-package C:\Components\lazserial\lazserialport.lpk

  # PascalScript - Doğru yolu bul
  - git clone https://github.com/remobjects/pascalscript.git C:\Components\pascalscript
  - echo "Finding PascalScript package..."
  - dir C:\Components\pascalscript /s /b | findstr ".lpk$" || echo "No .lpk files found, listing structure:"
  - dir C:\Components\pascalscript /ad
  # PascalScript paketini bul ve kur
  - if exist "C:\Components\pascalscript\Source\ScriptCompiler\PascalScript.lpk" (
      echo "Installing PascalScript from ScriptCompiler directory..."
      lazbuild --add-package C:\Components\pascalscript\Source\ScriptCompiler\PascalScript.lpk
    ) else if exist "C:\Components\pascalscript\Source\PascalScript.lpk" (
      echo "Installing PascalScript from Source directory..."
      lazbuild --add-package C:\Components\pascalscript\Source\PascalScript.lpk
    ) else if exist "C:\Components\pascalscript\PascalScript.lpk" (
      echo "Installing PascalScript from root directory..."
      lazbuild --add-package C:\Components\pascalscript\PascalScript.lpk
    ) else (
      echo "Searching for PascalScript package..."
      dir C:\Components\pascalscript /s /b | findstr ".lpk$"
    )

build_script:
  - ps: |
      cd $env:APPVEYOR_BUILD_FOLDER
      echo "Building main project..."
      lazbuild --os=win64 --cpu=x86_64 muterm.lpi

artifacts:
  - path: muterm.exe
    name: muterm

test: off
